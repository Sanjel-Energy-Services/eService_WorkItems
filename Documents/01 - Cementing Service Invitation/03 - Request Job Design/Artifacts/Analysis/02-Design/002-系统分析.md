## ğŸ¯ ç³»ç»Ÿé¢†åŸŸæ¨¡å‹

### 1. æ ¸å¿ƒå‚ä¸è€…è¯†åˆ«

```mermaid
classDiagram
    direction TB
    
    class SalesDispatch {
        <<businessActor>>
        +submitProgramRequest()
        +attachSupportingDocuments()
        +trackRequestStatus()
        +reviewApprovedProgram()
    }
    
    class Engineer {
        <<actor>>
        +draftProgram()
        +submitForReview()
        +addressComments()
        +uploadFinalProgram()
    }
    
    class EngineeringManager {
        <<actor>>
        +assignRequests()
        +approvePrograms()
        +monitorWorkload()
    }
    
    class DirectorVP {
        <<actor>>
        +approveBlackPrograms()
        +reviewMetrics()
    }
    
    class Approver {
        <<actor>>
        +reviewProgram()
        +approveReject()
        +addComments()
    }
    
    class OperationsTeam {
        <<actor>>
        +accessApprovedPrograms()
        +downloadPrograms()
    }
    
    class SystemAutomation {
        <<actor>>
        +autoAssignRequests()
        +generateProgramId()
        +sendNotifications()
        +trackTimestamps()
    }
```

### 2. æ ¸å¿ƒé¢†åŸŸå®ä½“ä¸èšåˆæ ¹

```mermaid
classDiagram
    direction TB
    
    class ProgramRequest {
        <<aggregate root>>
        -requestId: ProgramId
        -client: Client
        -requestType: RequestType
        -programType: ProgramType
        -complexityColor: ComplexityColor
        -serviceLine: ServiceLine
        -dueDate: DateTime
        -currentState: RequestLifecycleState
        -priority: Priority
        -classification: Classification
        +submit()
        +assignToEngineer()
        +markForReview()
        +approve()
        +reject()
        +complete()
    }
    
    class ProgramId {
        <<value object>>
        -id: String
        +generate()
        +validate()
    }
    
    class ProgramDocument {
        <<entity>>
        -documentId: String
        -version: Version
        -content: DocumentContent
        -uploadDate: DateTime
        +upload()
        +version()
        +validate()
    }
    
    class Approval {
        <<entity>>
        -approvalId: String
        -approver: Approver
        -decision: Decision
        -comments: Comments
        -timestamp: DateTime
        +approve()
        +reject()
        +addComments()
    }
    
    class CompanyMapping {
        <<entity>>
        -companyId: String
        -assignedEngineer: Engineer
        -serviceLine: ServiceLine
        +getAssignedEngineer()
        +updateMapping()
    }
```

### 3. äº”ç»´åº¦çŠ¶æ€æ¨¡å¼åº”ç”¨

#### 3.1 è¯·æ±‚ç”Ÿå‘½å‘¨æœŸçŠ¶æ€æ¨¡å¼

```mermaid
classDiagram
    direction TB
    
    class ProgramRequest {
        -currentState: RequestLifecycleState
        +changeState(newState: RequestLifecycleState)
    }
    
    class RequestLifecycleState {
        <<lifecycleState>>
        +canAssign() Boolean
        +canReview() Boolean
        +canApprove() Boolean
        +canComplete() Boolean
    }
    
    class OpenState {
        <<state>>
        +assignEngineer(request: ProgramRequest)
    }
    
    class ReceivedState {
        <<state>>
        +acknowledge(request: ProgramRequest)
    }
    
    class UnacknowledgedState {
        <<state>>
        +notifyAssignee(request: ProgramRequest)
    }
    
    class AcknowledgedState {
        <<state>>
        +beginWork(request: ProgramRequest)
    }
    
    class PendingState {
        <<state>>
        +awaitAssignment(request: ProgramRequest)
    }
    
    class InProgressState {
        <<state>>
        +markForReview(request: ProgramRequest)
    }
    
    class SentForReviewState {
        <<state>>
        +enterAwaitingReview(request: ProgramRequest)
    }
    
    class AwaitingReviewState {
        <<state>>
        +review(request: ProgramRequest)
    }
    
    class ReviewedState {
        <<state>>
        +prepareApproval(request: ProgramRequest)
    }
    
    class SentForApprovalState {
        <<state>>
        +enterAwaitingApproval(request: ProgramRequest)
    }
    
    class AwaitingApprovalState {
        <<state>>
        +approve(request: ProgramRequest)
        +reject(request: ProgramRequest)
    }
    
    class ApprovedState {
        <<state>>
        +sendToSales(request: ProgramRequest)
    }
    
    class SentToSalesState {
        <<state>>
        +deliver(request: ProgramRequest)
    }
    
    class CompletedState {
        <<state>>
        +archive(request: ProgramRequest)
    }
    
    ProgramRequest *--> "1" RequestLifecycleState
    RequestLifecycleState <|-- OpenState
    RequestLifecycleState <|-- ReceivedState
    RequestLifecycleState <|-- UnacknowledgedState
    RequestLifecycleState <|-- AcknowledgedState
    RequestLifecycleState <|-- PendingState
    RequestLifecycleState <|-- InProgressState
    RequestLifecycleState <|-- SentForReviewState
    RequestLifecycleState <|-- AwaitingReviewState
    RequestLifecycleState <|-- ReviewedState
    RequestLifecycleState <|-- SentForApprovalState
    RequestLifecycleState <|-- AwaitingApprovalState
    RequestLifecycleState <|-- ApprovedState
    RequestLifecycleState <|-- SentToSalesState
    RequestLifecycleState <|-- CompletedState
```

**çŠ¶æ€è½¬æ¢å›¾**ï¼š
```mermaid
stateDiagram-v2
    [*] --> OpenState
    OpenState --> ReceivedState : submit()
    ReceivedState --> UnacknowledgedState : notifyAssignee()
    UnacknowledgedState --> AcknowledgedState : assigneeAcknowledges()
    AcknowledgedState --> PendingState : needsAssignment()
    PendingState --> InProgressState : assignEngineer()
    InProgressState --> SentForReviewState : markForReview()
    SentForReviewState --> AwaitingReviewState : reviewerNotified()
    AwaitingReviewState --> ReviewedState : reviewComplete()
    ReviewedState --> SentForApprovalState : sendForApproval()
    SentForApprovalState --> AwaitingApprovalState : approversNotified()
    AwaitingApprovalState --> ApprovedState : approve()
    AwaitingApprovalState --> InProgressState : reject()
    ApprovedState --> SentToSalesState : sendToSales()
    SentToSalesState --> CompletedState : archive()
    CompletedState --> [*]
```

**çŠ¶æ€ä¸FRDå­—æ®µæ˜ å°„**ï¼š
| FRDçŠ¶æ€ | é¢†åŸŸæ¨¡å‹çŠ¶æ€ | è¯´æ˜ |
|---------|--------------|------|
| Open | OpenState | åˆå§‹åˆ›å»º |
| Received | ReceivedState | ç³»ç»Ÿæ¥æ”¶å¹¶è®°å½• |
| Unacknowledged | UnacknowledgedState | å·²æŒ‡æ´¾æœªç¡®è®¤ |
| Acknowledged | AcknowledgedState | å·¥ç¨‹å¸ˆå·²ç¡®è®¤ |
| Pending | PendingState | å¾…æ­£å¼å¼€å§‹/ç­‰å¾…èµ„æºæˆ–åˆ†é…ç»†åŒ– |
| In Progress | InProgressState | å·¥ç¨‹å¸ˆå¤„ç†ä¸­ |
| Sent for Review | SentForReviewState | å·²è§¦å‘è¯„å®¡é€šçŸ¥ |
| Awaiting Review | AwaitingReviewState | è¯„å®¡è€…ç­‰å¾…å¤„ç† |
| Reviewed | ReviewedState | è¯„å®¡å®Œæˆç»“æœå·²è®°å½• |
| Sent for Approval | SentForApprovalState | å·²è§¦å‘å®¡æ‰¹é€šçŸ¥ |
| Awaiting Approval | AwaitingApprovalState | ç­‰å¾…å®¡æ‰¹è¾“å…¥ |
| Approved | ApprovedState | å®¡æ‰¹é€šè¿‡å†…éƒ¨å®Œæˆ |
| Sent to Sales / Awaiting Pricing | SentToSalesState | å·²äº¤ä»˜é”€å”®å®šä»· |
| Completed | CompletedState | å½’æ¡£ç»“æŸ |

> æ³¨ï¼šFRDä¸­â€œçŠ¶æ€â€ä¸ç•Œé¢å±•ç¤ºæ ‡ç­¾ä¿æŒä¸€è‡´ï¼Œæœ¬æ¨¡å‹æ‰©å±•äº†è¿‡æ¸¡è¾…åŠ©çŠ¶æ€ä»¥æå‡å¯è¿½æº¯æ€§ã€‚

#### 3.2 å¤æ‚åº¦è¡Œä¸ºçŠ¶æ€æ¨¡å¼

```mermaid
classDiagram
    direction LR
    
    class ComplexityBehaviorState {
        <<behaviorState>>
        +getRequiredApprovers() List~Approver~
        +getApprovalWorkflow() ApprovalWorkflow
        +canAutoApprove() Boolean
    }
    
    class GreenComplexityState {
        <<state>>
        +getRequiredApprovers() List~Approver~
    }
    
    class YellowComplexityState {
        <<state>>
        +getRequiredApprovers() List~Approver~
    }
    
    class RedComplexityState {
        <<state>>
        +getRequiredApprovers() List~Approver~
    }
    
    class BlackComplexityState {
        <<state>>
        +getRequiredApprovers() List~Approver~
    }
    
    ProgramRequest *--> "1" ComplexityBehaviorState
    ComplexityBehaviorState <|-- GreenComplexityState
    ComplexityBehaviorState <|-- YellowComplexityState
    ComplexityBehaviorState <|-- RedComplexityState
    ComplexityBehaviorState <|-- BlackComplexityState
```

#### 3.3 ä¼˜å…ˆçº§ç»“æ„çŠ¶æ€æ¨¡å¼

```mermaid
classDiagram
    direction LR
    
    class PriorityStructuralState {
        <<structuralState>>
        +getSLAHours() Integer
        +getEscalationPath() EscalationPath
        +canAssignToOnCall() Boolean
    }
    
    class UrgentPriorityState {
        <<state>>
        +getSLAHours() Integer
    }
    
    class HighPriorityState {
        <<state>>
        +getSLAHours() Integer
    }
    
    class MediumPriorityState {
        <<state>>
        +getSLAHours() Integer
    }
    
    class LowPriorityState {
        <<state>>
        +getSLAHours() Integer
    }
    
    ProgramRequest *--> "1" PriorityStructuralState
    PriorityStructuralState <|-- UrgentPriorityState
    PriorityStructuralState <|-- HighPriorityState
    PriorityStructuralState <|-- MediumPriorityState
    PriorityStructuralState <|-- LowPriorityState
```

### 4. ä¸šåŠ¡æµæ¨¡å¼ç³»ç»ŸåŒ–åº”ç”¨

#### 4.1 çŠ¶æ€æœºé©±åŠ¨æµ - æ ¸å¿ƒå®¡æ‰¹æµç¨‹

```mermaid
sequenceDiagram
    participant SD as Sales/Dispatch
    participant SYS as System
    participant ENG as Engineer
    participant MGR as Manager
    participant DIR as Director
    
    Note over SD,DIR: ç¨‹åºè¯·æ±‚å®¡æ‰¹æµç¨‹
    SD->>SYS: submitProgramRequest()
    SYS->>SYS: generateProgramId()
    SYS->>SYS: autoAssignByCompanyMapping()
    SYS->>ENG: notifyAssignment()
    
    ENG->>SYS: draftProgram()
    ENG->>SYS: markForReview()
    
    alt Green Complexity
        SYS->>ENG: peerReview()
    else Yellow Complexity
        SYS->>MGR: managerReview()
    else Red Complexity
        SYS->>MGR: managerApproval()
    else Black Complexity
        SYS->>MGR: managerReview()
        SYS->>DIR: directorApproval()
    end
    
    MGR->>SYS: approveWithComments()
    SYS->>SD: notifyApproval()
```

#### 4.2 ä¸šåŠ¡æµç¨‹é©±åŠ¨æµ - ç«¯åˆ°ç«¯å¤„ç†

```mermaid
flowchart TD
    A[ğŸ“§ è¯·æ±‚æäº¤<br>Email/Portal] --> B[ğŸ†” ç”ŸæˆProgram ID]
    B --> C[ğŸ‘¤ è‡ªåŠ¨åˆ†é…å·¥ç¨‹å¸ˆ]
    C --> D[ğŸ“Š åŸºäºåˆ°æœŸæ—¥è®¾ç½®ä¼˜å…ˆçº§]
    D --> E[ğŸ“ å·¥ç¨‹å¸ˆèµ·è‰ç¨‹åº]
    E --> F{åŸºäºå¤æ‚åº¦é¢œè‰²çš„å®¡æ‰¹è·¯å¾„}
    
    F -->|Green| G[ğŸ‘¥ åŒè¡Œè¯„å®¡]
    F -->|Yellow| H[ğŸ‘¨â€ğŸ’¼ ç»ç†è¯„å®¡]
    F -->|Red| I[ğŸ‘¨â€ğŸ’¼ ç»ç†æ‰¹å‡†]
    F -->|Black| J[ğŸ‘¨â€ğŸ’¼ ç»ç† + ğŸ‘¨â€ğŸ’¼ æ€»ç›‘æ‰¹å‡†]
    
    G --> K[âœ… æ‰¹å‡†]
    H --> K
    I --> K
    J --> K
    
    K --> L[ğŸ“¤ è¿”å›é”€å”®/å®¢æˆ·]
    L --> M[ğŸ’¾ å½’æ¡£å’Œæ—¥å¿—è®°å½•]
```

### 5. å®Œæ•´é¢†åŸŸæ¨¡å‹æ¦‚è§ˆ

```mermaid
classDiagram
    direction TB
    
    %% å‚ä¸è€…
    class SalesDispatch {
        <<businessActor>>
    }
    
    class Engineer {
        <<actor>>
    }
    
    class EngineeringManager {
        <<actor>>
    }
    
    %% èšåˆæ ¹
    class ProgramRequest {
        <<aggregate root>>
    }
    
    class CompanyMapping {
        <<aggregate root>>
    }
    
    %% å®ä½“
    class ProgramDocument {
        <<entity>>
    }
    
    class Approval {
        <<entity>>
    }
    
    class Notification {
        <<entity>>
    }
    
    %% å€¼å¯¹è±¡
    class ProgramId {
        <<value object>>
    }
    
    class ComplexityMatrix {
        <<value object>>
    }
    
    class ServiceLine {
        <<value object>>
    }
    
    %% çŠ¶æ€æ¨¡å¼
    class RequestLifecycleState {
        <<lifecycleState>>
    }
    
    class ComplexityBehaviorState {
        <<behaviorState>>
    }
    
    class PriorityStructuralState {
        <<structuralState>>
    }
    
    %% æ ¸å¿ƒå…³ç³»
    SalesDispatch "1" *-- "*" ProgramRequest : submits
    ProgramRequest "1" *-- "*" ProgramDocument : contains
    ProgramRequest "1" *-- "*" Approval : undergoes
    ProgramRequest *--> "1" RequestLifecycleState
    ProgramRequest *--> "1" ComplexityBehaviorState
    ProgramRequest *--> "1" PriorityStructuralState
    CompanyMapping "1" *-- "*" ProgramRequest : maps
    
    Engineer "1" *-- "*" ProgramRequest : assigned
    EngineeringManager "1" *-- "*" Approval : provides
    
    %% æ ·å¼å®šä¹‰
    style SalesDispatch fill:#a6c1ff,stroke:#333,stroke-width:2px
    style Engineer fill:#a6c1ff,stroke:#333,stroke-width:2px
    style EngineeringManager fill:#a6c1ff,stroke:#333,stroke-width:2px
    
    style ProgramRequest fill:#a8e6a1,stroke:#333,stroke-width:2px
    style CompanyMapping fill:#a8e6a1,stroke:#333,stroke-width:2px
    
    style ProgramDocument fill:#fff9a8,stroke:#333,stroke-width:2px
    style Approval fill:#fff9a8,stroke:#333,stroke-width:2px
    style Notification fill:#fff9a8,stroke:#333,stroke-width:2px
    
    style RequestLifecycleState fill:#ffd8a6,stroke:#333,stroke-width:2px
    style ComplexityBehaviorState fill:#ffd8a6,stroke:#333,stroke-width:2px
    style PriorityStructuralState fill:#ffd8a6,stroke:#333,stroke-width:2px
```

### 6. å…³é”®ä¸šåŠ¡è§„åˆ™

#### 6.1 è‡ªåŠ¨åˆ†é…è§„åˆ™
```yaml
AutoAssignment:
  rules:
    - if: company_mapping_exists
      then: assign_to_mapped_engineer
    - if: no_mapping_found
      then: assign_to_engineering_manager
    - if: urgent_or_after_hours
      then: assign_to_on_call_engineer
```

#### 6.2 å®¡æ‰¹çŸ©é˜µè§„åˆ™
```yaml
ApprovalMatrix:
  Green: 
    required_approvers: ["Peer Engineer"]
  Yellow:
    required_approvers: ["Manager/Lead"]
  Red:
    required_approvers: ["Manager"]
  Black:
    required_approvers: ["Manager", "Director/VP"]
```

#### 6.3 ä¼˜å…ˆçº§è®¡ç®—è§„åˆ™
```yaml
PriorityCalculation:
  Urgent: "<4 hours to due date"
  High: "Same day due date"
  Medium: "Within 2 days"
  Low: ">2 days"
```

### 7. æ¨¡å¼ç»„åˆéªŒè¯

**æœ‰æ•ˆæ¨¡å¼ç»„åˆ**ï¼š
```yaml
ProgramRequestManagement:
  state_patterns:
    - lifecycle: è¯·æ±‚ç”Ÿå‘½å‘¨æœŸçŠ¶æ€
    - behavioral: å¤æ‚åº¦è¡Œä¸ºçŠ¶æ€
    - structural: ä¼˜å…ˆçº§ç»“æ„çŠ¶æ€
  flow_patterns:
    - state_machine: çŠ¶æ€æœºé©±åŠ¨å®¡æ‰¹æµ
    - business_process: ç«¯åˆ°ç«¯ä¸šåŠ¡æµç¨‹
```
